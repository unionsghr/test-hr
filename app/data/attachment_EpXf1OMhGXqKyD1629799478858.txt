create or replace view final_salaries as select sum(ifnull(`hrmdatatest_utb`.`salaries`.`basic_salary`,0)) AS `component_amount`,'Basic Salary' AS `component_type`,'D' AS `flag`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,'143000000001' AS `general_ledger`,'Permanent' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`car_allowance`,0)) AS `component_amount`,'Car Allowance' AS `component_type`,'D' AS `flag`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,'143000000002' AS `general_ledger`,'Permanent' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`honorarium`,0)) AS `component_amount`,'Honorarium' AS `component_type`,'D' AS `flag`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,'143000000002' AS `general_ledger`,'Permanent' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`transport`,0)) AS `component_amount`,'Transport' AS `component_type`,'D' AS `flag`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,'143000000002' AS `general_ledger`,'Permanent' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`lunch`,0)) AS `component_amount`,'Lunch' AS `component_type`,'D' AS `flag`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,'143000000002' AS `general_ledger`,'Permanent' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`monthly_rent`,0)) AS `component_amount`,'Monthly Rent' AS `component_type`,'D' AS `flag`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,'143000000002' AS `general_ledger`,'Permanent' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`employer_nassit`,0)) AS `component_amount`,'Employer NASSIT' AS `component_type`,'D' AS `flag`,'000' AS `branch_code`,'143000000007' AS `general_ledger`,'Permanent & Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`nassit`,0)) AS `component_amount`,'Employee NASSIT' AS `component_type`,'C' AS `flag`,'000' AS `branch_code`,'123620000021' AS `general_ledger`,'Permanent & Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`medical_excess`,0)) AS `component_amount`,'Medical Excess' AS `component_type`,'C' AS `flag`,'000' AS `branch_code`,'143000000003' AS `general_ledger`,'Permanent' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`union_dues`,0)) AS `component_amount`,'Union Dues' AS `component_type`,'C' AS `flag`,'000' AS `branch_code`,'123440000003' AS `general_ledger`,'Permanent' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`paye`,0)) AS `component_amount`,'PAYE' AS `compnent_type`,'C' AS `flag`,'000' AS `branch_code`,'123620000010' AS `general_ledger`,'Permanent' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`witholding_tax`,0)) AS `component_amount`,'Witholding Tax' AS `compnent_type`,'C' AS `flag`,'000' AS `branch_code`,'123620000005' AS `general_ledger`,'Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`employer_nassit`,0)) AS `component_amount`,'Employer NASSIT' AS `compnent_type`,'C' AS `flag`,'000' AS `branch_code`,'123620000021' AS `general_ledger`,'Permanent & Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '001' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`basic_salary`,0)) AS `component_amount`,'Basic Salary' AS `component_type`,'D' AS `flag`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,'146000000023' AS `general_ledger`,'Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`car_allowance`,0)) AS `component_amount`,'Car Allowance' AS `component_type`,'D' AS `flag`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,'143000000002' AS `general_ledger`,'Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`honorarium`,0)) AS `component_amount`,'Honorarium' AS `component_type`,'D' AS `flag`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,'143000000002' AS `general_ledger`,'Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`transport`,0)) AS `component_amount`,'Transport' AS `component_type`,'D' AS `flag`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,'143000000002' AS `general_ledger`,'Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`lunch`,0)) AS `component_amount`,'Lunch' AS `component_type`,'D' AS `flag`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,'143000000002' AS `general_ledger`,'Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`monthly_rent`,0)) AS `component_amount`,'Monthly Rent' AS `component_type`,'D' AS `flag`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,'143000000002' AS `general_ledger`,'Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`employer_nassit`,0)) AS `component_amount`,'Employer NASSIT' AS `component_type`,'D' AS `flag`,'000' AS `branch_code`,'143000000007' AS `general_ledger`,'Permanent & Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`nassit`,0)) AS `component_amount`,'Employee NASSIT' AS `component_type`,'C' AS `flag`,'000' AS `branch_code`,'123620000021' AS `general_ledger`,'Permanent & Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`medical_excess`,0)) AS `component_amount`,'Medical Excess' AS `component_type`,'C' AS `flag`,'000' AS `branch_code`,'143000000003' AS `general_ledger`,'Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`union_dues`,0)) AS `component_amount`,'Union Dues' AS `component_type`,'C' AS `flag`,'000' AS `branch_code`,'123440000003' AS `general_ledger`,'Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`paye`,0)) AS `component_amount`,'PAYE' AS `compnent_type`,'C' AS `flag`,'000' AS `branch_code`,'123620000010' AS `general_ledger`,'Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`witholding_tax`,0)) AS `component_amount`,'Witholding Tax' AS `compnent_type`,'C' AS `flag`,'000' AS `branch_code`,'123620000005' AS `general_ledger`,'Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code` union all select sum(ifnull(`hrmdatatest_utb`.`salaries`.`employer_nassit`,0)) AS `component_amount`,'Employer NASSIT' AS `compnent_type`,'C' AS `flag`,'000' AS `branch_code`,'123620000021' AS `general_ledger`,'Permanent & Contract' AS `status` from `hrmdatatest_utb`.`salaries` where `hrmdatatest_utb`.`salaries`.`summary` = 'Yes' and `hrmdatatest_utb`.`salaries`.`status` = 'Active' and `hrmdatatest_utb`.`salaries`.`posting_type` = '002' group by `hrmdatatest_utb`.`salaries`.`branch_code`;

create or replace view gl_summary as select sum(ifnull(`final_salaries`.`component_amount`,0)) AS `component_amount`,`final_salaries`.`component_type` AS `component_type`,`final_salaries`.`flag` AS `flag`,`final_salaries`.`branch_code` AS `branch_code`,`final_salaries`.`general_ledger` AS `general_ledger`,`final_salaries`.`status` AS `status` from `hrmdatatest_utb`.`final_salaries` where `final_salaries`.`flag` = 'C' group by `final_salaries`.`branch_code`,`final_salaries`.`general_ledger`,`final_salaries`.`component_type`,`final_salaries`.`flag` union all select sum(ifnull(`final_salaries`.`component_amount`,0)) AS `component_amount`,`final_salaries`.`component_type` AS `component_type`,`final_salaries`.`flag` AS `flag`,`final_salaries`.`branch_code` AS `branch_code`,`final_salaries`.`general_ledger` AS `general_ledger`,`final_salaries`.`status` AS `status` from `hrmdatatest_utb`.`final_salaries` where `final_salaries`.`flag` = 'D' group by `final_salaries`.`branch_code`,`final_salaries`.`general_ledger`,`final_salaries`.`component_type`,`final_salaries`.`flag`;

create or replace view payroll_data as select `hrmdata`.`payrolldata`.`employee` AS `employee`,`hrmdata`.`payrolldata`.`payroll` AS `payroll`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `paye`.`payroll_item` from `hrmdata`.`payrolldata` `paye` order by 1 limit 0,1) then `hrmdata`.`payrolldata`.`amount` end) AS `BASIC`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 1,1) then `hrmdata`.`payrolldata`.`amount` end) AS `HONORARIUM`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 2,1) then `hrmdata`.`payrolldata`.`amount` end) AS `CAR`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `paye`.`payroll_item` from `hrmdata`.`payrolldata` `paye` order by 1 limit 3,1) then `hrmdata`.`payrolldata`.`amount` end) AS `TRANSPORT`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 4,1) then `hrmdata`.`payrolldata`.`amount` end) AS `LUNCH`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 5,1) then `hrmdata`.`payrolldata`.`amount` end) AS `GROSS_SALARY`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 6,1) then `hrmdata`.`payrolldata`.`amount` end) AS `NASSIT_5`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `paye`.`payroll_item` from `hrmdata`.`payrolldata` `paye` order by 1 limit 7,1) then `hrmdata`.`payrolldata`.`amount` end) AS `MEDICAL_EXCESS`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 8,1) then `hrmdata`.`payrolldata`.`amount` end) AS `UNION_DUES`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 9,1) then `hrmdata`.`payrolldata`.`amount` end) AS `MONTHLY_RENT`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 10,1) then `hrmdata`.`payrolldata`.`amount` end) AS `PAYE`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `paye`.`payroll_item` from `hrmdata`.`payrolldata` `paye` order by 1 limit 11,1) then `hrmdata`.`payrolldata`.`amount` end) AS `TOTAL_DEDUCTION`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 12,1) then `hrmdata`.`payrolldata`.`amount` end) AS `NET_SALARY`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 13,1) then `hrmdata`.`payrolldata`.`amount` end) AS `NASSIT10_DEDUCT`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 14,1) then `hrmdata`.`payrolldata`.`amount` end) AS `WITHOLDING_TAX`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `paye`.`payroll_item` from `hrmdata`.`payrolldata` `paye` order by 1 limit 15,1) then `hrmdata`.`payrolldata`.`amount` end) AS `NASSIT10_PAYT`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 16,1) then `hrmdata`.`payrolldata`.`amount` end) AS `BASIC_AN`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 17,1) then `hrmdata`.`payrolldata`.`amount` end) AS `TOTAL_ALLOWANCE`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 18,1) then `hrmdata`.`payrolldata`.`amount` end) AS `BASIC_TAX_FREE`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `paye`.`payroll_item` from `hrmdata`.`payrolldata` `paye` order by 1 limit 19,1) then `hrmdata`.`payrolldata`.`amount` end) AS `TAXABLE_BASIC`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 20,1) then `hrmdata`.`payrolldata`.`amount` end) AS `TAXABLE_INCOME`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 21,1) then `hrmdata`.`payrolldata`.`amount` end) AS `NASSIT5_CONTRACT`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 22,1) then `hrmdata`.`payrolldata`.`amount` end) AS `TOTAL_DEDUCT_CONTRACT`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `paye`.`payroll_item` from `hrmdata`.`payrolldata` `paye` order by 1 limit 23,1) then `hrmdata`.`payrolldata`.`amount` end) AS `NET_SALARY_CONTRACT`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 24,1) then `hrmdata`.`payrolldata`.`amount` end) AS `TAXABLE_ALLOWANCE`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 25,1) then `hrmdata`.`payrolldata`.`amount` end) AS `CASUAL_LABOUR`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `a`.`payroll_item` from `hrmdata`.`payrolldata` `a` order by 1 limit 26,1) then `hrmdata`.`payrolldata`.`amount` end) AS `NASSIT10_DEDT_CONTR`,sum(case when `hrmdata`.`payrolldata`.`payroll_item` = (select distinct `paye`.`payroll_item` from `hrmdata`.`payrolldata` `paye` order by 1 limit 27,1) then `hrmdata`.`payrolldata`.`amount` end) AS `NASSIT10_PAYT_CONTR` from `hrmdata`.`payrolldata` group by `hrmdata`.`payrolldata`.`employee`,`hrmdata`.`payrolldata`.`payroll` order by 1;

create or replace view salaries_view as select `hrmdatatest_utb`.`salaries`.`id` AS `id`,`hrmdatatest_utb`.`salaries`.`employee` AS `employee`,`hrmdatatest_utb`.`salaries`.`emp_id` AS `emp_id`,`hrmdatatest_utb`.`salaries`.`pay_grade` AS `pay_grade`,`hrmdatatest_utb`.`salaries`.`account_no` AS `account_no`,`hrmdatatest_utb`.`salaries`.`nassit_no` AS `nassit_no`,`hrmdatatest_utb`.`salaries`.`notch` AS `notch`,`hrmdatatest_utb`.`salaries`.`branch_code` AS `branch_code`,`hrmdatatest_utb`.`salaries`.`summary` AS `summary`,`hrmdatatest_utb`.`salaries`.`working_days` AS `working_days`,`hrmdatatest_utb`.`salaries`.`basic_salary` AS `basic_salary`,`hrmdatatest_utb`.`salaries`.`car_allowance` AS `car_allowance`,`hrmdatatest_utb`.`salaries`.`honorarium` AS `honorarium`,`hrmdatatest_utb`.`salaries`.`transport` AS `transport`,`hrmdatatest_utb`.`salaries`.`lunch` AS `lunch`,`hrmdatatest_utb`.`salaries`.`rent_witheld` AS `rent_witheld`,`hrmdatatest_utb`.`salaries`.`monthly_rent` AS `monthly_rent`,`hrmdatatest_utb`.`salaries`.`monthly` AS `monthly`,`hrmdatatest_utb`.`salaries`.`nassit` AS `nassit`,`hrmdatatest_utb`.`salaries`.`employer_nassit` AS `employer_nassit`,`hrmdatatest_utb`.`salaries`.`total_nassit` AS `total_nassit`,`hrmdatatest_utb`.`salaries`.`medical_excess` AS `medical_excess`,`hrmdatatest_utb`.`salaries`.`union_dues` AS `union_dues`,`hrmdatatest_utb`.`salaries`.`basic_after_nassit` AS `basic_after_nassit`,`hrmdatatest_utb`.`salaries`.`total_allowance` AS `total_allowance`,`hrmdatatest_utb`.`salaries`.`gross_salary` AS `gross_salary`,`hrmdatatest_utb`.`salaries`.`taxable_basic` AS `taxable_basic`,`hrmdatatest_utb`.`salaries`.`taxable_income` AS `taxable_income`,`hrmdatatest_utb`.`salaries`.`paye` AS `paye`,`hrmdatatest_utb`.`salaries`.`witholding_tax` AS `witholding_tax`,`hrmdatatest_utb`.`salaries`.`taxable_allowance` AS `taxable_allowance`,`hrmdatatest_utb`.`salaries`.`total_deduction` AS `total_deduction`,`hrmdatatest_utb`.`salaries`.`net_salary` AS `net_salary`,`hrmdatatest_utb`.`salaries`.`date_created` AS `date_created`,`hrmdatatest_utb`.`salaries`.`prefix` AS `prefix`,`hrmdatatest_utb`.`salaries`.`status` AS `status`,`hrmdatatest_utb`.`salaries`.`employment_type` AS `employment_type`,`hrmdatatest_utb`.`salaries`.`pays_nassit` AS `pays_nassit`,`hrmdatatest_utb`.`salaries`.`posting_type` AS `posting_type`,`hrmdatatest_utb`.`employees`.`first_name` AS `first_name`,`hrmdatatest_utb`.`employees`.`middle_name` AS `middle_name`,`hrmdatatest_utb`.`employees`.`last_name` AS `last_name` from (`hrmdatatest_utb`.`salaries` join `hrmdatatest_utb`.`employees`) where `hrmdatatest_utb`.`salaries`.`employee` = `hrmdatatest_utb`.`employees`.`id` and `hrmdatatest_utb`.`salaries`.`monthly` <> 2;

create or replace view vw_employeesalary as select distinct `hrmdatatest_utb`.`employeesalary`.`id` AS `id`,`hrmdatatest_utb`.`employeesalary`.`employee` AS `employee`,`hrmdatatest_utb`.`employeesalary`.`component` AS `component`,`hrmdatatest_utb`.`employees`.`bank_acc_no` AS `bank_acc_no`,`hrmdatatest_utb`.`employees`.`branch` AS `branch`,`hrmdatatest_utb`.`employees`.`status` AS `status`,`hrmdatatest_utb`.`employeesalary`.`working_days` AS `working_days`,`hrmdatatest_utb`.`employeesalary`.`pay_frequency` AS `pay_frequency`,`hrmdatatest_utb`.`notches`.`currency` AS `currency`,`hrmdatatest_utb`.`employeesalary`.`amount` AS `amount`,`hrmdatatest_utb`.`salarycomponent`.`name` AS `narration`,`hrmdatatest_utb`.`salarycomponent`.`salarycomp_gl` AS `salarycomp_gl` from (((`hrmdatatest_utb`.`employeesalary` join `hrmdatatest_utb`.`salarycomponent`) join `hrmdatatest_utb`.`notches`) join `hrmdatatest_utb`.`employees`) where `hrmdatatest_utb`.`employeesalary`.`component` <> '1' and `hrmdatatest_utb`.`employeesalary`.`component` = `hrmdatatest_utb`.`salarycomponent`.`id` and `hrmdatatest_utb`.`employees`.`id` = `hrmdatatest_utb`.`employeesalary`.`employee` and `hrmdatatest_utb`.`employees`.`status` = 'Active' union all select distinct `a`.`id` AS `id`,`a`.`employee` AS `employee`,`a`.`component` AS `component`,`b`.`bank_acc_no` AS `bank_acc_no`,`b`.`branch` AS `branch`,`b`.`status` AS `status`,`a`.`working_days` AS `working_days`,`a`.`pay_frequency` AS `pay_frequency`,`c`.`currency` AS `currency`,`c`.`amount` / 22 * `a`.`working_days` AS `amount`,`d`.`name` AS `narration`,`d`.`salarycomp_gl` AS `salarycomp_gl` from (((`hrmdatatest_utb`.`employeesalary` `a` join `hrmdatatest_utb`.`employees` `b`) join `hrmdatatest_utb`.`notches` `c`) join `hrmdatatest_utb`.`salarycomponent` `d`) where `a`.`component` = '1' and `b`.`status` = 'Active' and `c`.`id` = `b`.`notches` and `b`.`id` = `a`.`employee` and `a`.`component` = `d`.`id`;

create or replace view vw_empsalarydetails as select `hrmdata`.`employees`.`id` AS `id`,`hrmdata`.`employees`.`employee_id` AS `employee_id`,`hrmdata`.`employees`.`first_name` AS `FIRST_name`,`hrmdata`.`employees`.`middle_name` AS `middle_name`,`hrmdata`.`employees`.`last_name` AS `last_name`,`hrmdata`.`employees`.`bank_acc_no` AS `bank_acc_no`,`hrmdata`.`employees`.`pay_grade` AS `pay_grade`,`hrmdata`.`employees`.`notches` AS `notches`,`hrmdata`.`employees`.`employment_status` AS `employment_status` from `hrmdata`.`employees`;

create or replace view vw_final_salaries as select `a`.`id` AS `id`,`a`.`employee_id` AS `employee_id`,`a`.`first_name` AS `first_name`,`a`.`middle_name` AS `middle_name`,`a`.`last_name` AS `last_name`,`a`.`bank_acc_no` AS `bank_acc_no`,`a`.`pay_grade` AS `pay_grade`,`a`.`notches` AS `notches`,`a`.`employment_status` AS `employment_status`,`b`.`payroll` AS `payroll`,`b`.`employee` AS `employee`,`b`.`BASIC` AS `basic`,`b`.`HONORARIUM` AS `honorarium`,`b`.`CAR` AS `car`,`b`.`TRANSPORT` AS `transport`,`b`.`LUNCH` AS `lunch`,`b`.`GROSS_SALARY` AS `gross_salary`,`b`.`NASSIT_5` AS `nassit_5`,`b`.`MEDICAL_EXCESS` AS `medical_excess`,`b`.`UNION_DUES` AS `union_dues`,`b`.`MONTHLY_RENT` AS `monthly_rent`,`b`.`PAYE` AS `paye`,`b`.`TOTAL_DEDUCTION` AS `total_deduction`,`b`.`NET_SALARY` AS `net_salary`,`b`.`NASSIT10_DEDUCT` AS `nassit10_deduct`,`b`.`WITHOLDING_TAX` AS `witholding_tax`,`b`.`NASSIT10_PAYT` AS `nassit10_payt`,`b`.`BASIC_AN` AS `basic_an`,`b`.`TOTAL_ALLOWANCE` AS `total_allowance`,`b`.`BASIC_TAX_FREE` AS `basic_tax_free`,`b`.`TAXABLE_BASIC` AS `taxable_basic`,`b`.`TAXABLE_INCOME` AS `taxable_income`,`b`.`NASSIT5_CONTRACT` AS `nassit5_contract`,`b`.`TOTAL_DEDUCT_CONTRACT` AS `total_deduct_contract`,`b`.`NET_SALARY_CONTRACT` AS `net_salary_contract`,`b`.`TAXABLE_ALLOWANCE` AS `taxable_allowance`,`b`.`CASUAL_LABOUR` AS `casual_labour`,`b`.`NASSIT10_DEDT_CONTR` AS `nassit10_dedt_contr`,`b`.`NASSIT10_PAYT_CONTR` AS `nassit10_payt_contr`,`a`.`ssn_num` AS `NASSIT_NO`,`a`.`branch` AS `branch` from (`hrmdata`.`employees` `a` join `hrmdata`.`payroll_data` `b` on(`a`.`id` = `b`.`employee`));

create or replace view vw_salary as select `hrmdata`.`payrolldata`.`payroll` AS `payroll`,`hrmdata`.`payrolldata`.`employee` AS `employee`,`hrmdata`.`payrolldata`.`amount` AS `amount` from (`hrmdata`.`payrolldata` join `hrmdata`.`payrollcolumns` on(`hrmdata`.`payrolldata`.`payroll_item` = `hrmdata`.`payrollcolumns`.`id`));

create or replace view 	vw_employeemedical_amount as select `vij`.`employee` AS `employee`,sum(`vij`.`cost`) AS `amount` from (select `hrmdata`.`staffmedical`.`employee` AS `employee`,`hrmdata`.`staffmedical`.`cost` AS `cost` from `hrmdata`.`staffmedical` union select `hrmdata`.`dependentmedical`.`employee` AS `employee`,`hrmdata`.`dependentmedical`.`cost` AS `cost` from `hrmdata`.`dependentmedical`) `vij` group by `vij`.`employee`;

create or replace view vw_empsal_medicalbalance as select distinct `a`.`employee` AS `employee`,`a`.`medical_balance` AS `medical_balance` from (`hrmdata`.`vw_staff_medical_balance` `a` join `hrmdata`.`employeesalary` `b` on(`a`.`employee` = `b`.`employee`));

create or replace view vw_medicallimit as select `a`.`notch` AS `notch`,`a`.`percentage` AS `percentage`,`b`.`amount` * `a`.`percentage` AS `limit_amount` from (`hrmdata`.`medicallimit` `a` join `hrmdata`.`notches` `b` on(`b`.`id` = `a`.`notch`));

create or replace view vw_medical_notch as select `a`.`employee` AS `employee`,`a`.`amount` AS `amount`,`b`.`notches` AS `notches` from (`hrmdata`.`vw_employeemedical_amount` `a` join `hrmdata`.`employees` `b` on(`a`.`employee` = `b`.`id`));

create or replace view vw_staff_medical_balance as select `a`.`employee` AS `employee`,`a`.`notches` AS `notches`,`a`.`amount` AS `amount`,`b`.`limit_amount` AS `medical_limit`,(select `b`.`limit_amount` - `a`.`amount`) AS `medical_balance` from `hrmdata`.`vw_medical_notch` `a` join `hrmdata`.`vw_medicallimit` `b` where `a`.`notches` = `b`.`notch`;

